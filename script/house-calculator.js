// 页面切换标签$('.calculator-tab li').on('click',function () {    let _index = $(this).index();    $(this).addClass('current').siblings().removeClass('current');    $('.calculator-form').eq(_index).show().siblings().hide();    resetChart(); // 重置图表    formState.hideMsg(); // 清空显示    if(_index == 0){        showLoanTemp();    }else if (_index == 1){        showSecTemp();    }    _pass = false;});const RATE = { // 配置贷款利率    business : 4.90,    public : 3.25};// 贷款状态var formState = {    loanType : 0,                   // 贷款类型 【0:商 1:公 2:混】    loanMode : 0,                   // 贷款方式 【0:等额本金 1:等额本息】    countType : 0,                  // 计算方式 【0:面积 2:贷款额度】    mortgageRatio : 0.7,            // 贷款比例    mortgageYears : 20,             // 贷款年数    mortgageMonths : 240,           // 计算贷款月数    yearSale : 1,                   // 年数打折    yearPublicSale : 1,             // 年数公积金打折    mortgageSale : 1,               // 按揭打折    mortgagePublicSale : 1,               // 按揭打折    acreage : 0,                    // 面积    univalent : 0,                  // 单价    roteBusiness : 0,               // 计算商业利率    rotePublic : 0,                 // 计算公积金利率    total : 0,                      // 计算总价    firstPayment : 0,               // 计算首付数    mortgageCapital : 0,            // 计算贷款本金    mortgagePublicCapital : 0,      // 计算贷款本金    mortgageAllCapital : 0,         // 计算贷款本金    mortgageTotal : 0,              // 计算商贷款总额    mortgagePublicTotal : 0,        // 计算公积金贷款总额    mortgageAllTotal : 0,           // 计算组合贷款总额    monthRepay : 0,                 // 商贷月还款    monthPublicRepay : 0,           // 公积金月还款    monthAllRepay : 0,              // 组合月还款    interestTotal : 0,              // 利息总数商贷    interestPublicTotal : 0,        // 利息总数公积金    interestAllTotal : 0,           // 利息总数公积金    minusMouth : 0,                 // 等额本金每月少还数    minusPublicMouth : 0,    minusAllMouth : 0,    /*-------------------------------------------------     * 配置方法     * -----------------------------------------------*/    setLoanType : function (type) {        switch(type){            case 0 :                this.loanType = 0;                break;            case 1 :                this.loanType = 1;                break;            case 2 :                this.loanType = 2;                break;        }        this.countRate();    },    /*-------------------------------------------------     * 计算方法     * -----------------------------------------------*/    countRate : function countRate() { // 计算利率        let self = this;        function countBusinessRate() { // 商贷            if (self.mortgageYears === 1){                self.yearSale = 0.8877551;            }else if(self.mortgageYears > 1 && self.mortgageYears <= 5){                self.yearSale = 0.96938776;            }else{                self.yearSale = 1;            }            self.roteBusiness = Math.round(Math.round(RATE.business * 100 * self.yearSale) * self.mortgageSale) / 100;        }        function countPublicRate() { // 公贷            if(self.mortgageYears <= 5){                self.yearPublicSale = 0.84615385;            }else{                self.yearPublicSale = 1;            }            self.rotePublic = Math.round(Math.round(RATE.public * 100 * self.yearPublicSale) * self.mortgagePublicSale) / 100;        }        countBusinessRate();        countPublicRate();        this.showRate();    },    countTotal : function () { // 计算总价        if(this.countType == 0){            this.total = this.acreage * this.univalent;        }        this.countMortgageCapital();    // 计算贷款本金        this.countMortgageTotal();      // 计算贷款总数        this.countInterestTotal();      // 计算利息        this.showMsg();                 // 渲染HTML    },    countMortgageCapital : function(){ // 计算贷款本金        switch (this.loanType){            case 0 :                if(this.countType === 0){                    this.mortgageCapital = this.total * this.mortgageRatio;                    this.countFirstPayment();       // 计算首付                }                if (this.loanMode == 0){                    this.monthRepay = this.getPaymentsPerMonth(this.mortgageCapital,this.roteBusiness); // 计算商贷月还                }else{                    let businessMsg = this.getPaymentsPerMonthCut(this.mortgageCapital,this.roteBusiness);                    // console.log(businessMsg)                    this.mortgageCapital = businessMsg.sum;                                      // 贷款本金                    this.monthRepay = businessMsg.firstMouthAll;                                 // 第一个月还                    this.minusMouth = businessMsg.minusMouth;                                    // 每月减少                    this.interestTotal = businessMsg.interest;                                   // 全部利息                    this.mortgageTotal = this.mortgageCapital + this.interestTotal;              // 贷款总额                }                break;            case 1 :                if(this.countType === 0){                    this.mortgagePublicCapital = this.total * this.mortgageRatio;                    this.countFirstPayment();       // 计算首付                }                if(this.loanMode == 0){                    this.monthPublicRepay = this.getPaymentsPerMonth(this.mortgagePublicCapital,this.rotePublic); // 计算公积金月还                }else{                    let publicMsg = this.getPaymentsPerMonthCut(this.mortgagePublicCapital,this.rotePublic);                    // console.log(publicMsg)                    this.mortgagePublicCapital = publicMsg.sum;                                      // 贷款本金                    this.monthPublicRepay = publicMsg.firstMouthAll;                                 // 第一个月还                    this.minusPublicMouth = publicMsg.minusMouth;                                    // 每月减少                    this.interestPublicTotal = publicMsg.interest;                                   // 全部利息                    this.mortgagePublicTotal = this.mortgagePublicCapital + this.interestPublicTotal;      // 贷款总额                }                break;            case 2 :                if(this.loanMode == 0){                    this.mortgageAllCapital = this.mortgageCapital + this.mortgagePublicCapital;                    this.monthRepay = this.getPaymentsPerMonth(this.mortgageCapital,this.roteBusiness); // 计算商贷月还                    this.monthPublicRepay = this.getPaymentsPerMonth(this.mortgagePublicCapital,this.rotePublic); // 计算公积金月还                    this.monthAllRepay = this.monthRepay + this.monthPublicRepay;                }else{                    let businessMsg = this.getPaymentsPerMonthCut(this.mortgageCapital,this.roteBusiness),                        publicMsg = this.getPaymentsPerMonthCut(this.mortgagePublicCapital,this.rotePublic);                    // console.log(businessMsg);                    // console.log(publicMsg);                    // 商贷                    this.mortgageCapital = businessMsg.sum;                                      // 贷款本金                    this.monthRepay = businessMsg.firstMouthAll;                                 // 第一个月还                    this.minusMouth = businessMsg.minusMouth;                                    // 每月减少                    this.interestTotal = businessMsg.interest;                                   // 全部利息                    this.mortgageTotal = this.mortgageCapital + this.interestTotal;              // 贷款总额                    // 公贷                    this.mortgagePublicCapital = publicMsg.sum;                                      // 贷款本金                    this.monthPublicRepay = publicMsg.firstMouthAll;                                 // 第一个月还                    this.minusPublicMouth = publicMsg.minusMouth;                                    // 每月减少                    this.interestPublicTotal = publicMsg.interest;                                   // 全部利息                    this.mortgagePublicTotal = this.mortgagePublicCapital + this.interestPublicTotal;      // 贷款总额                    // 总合                    this.mortgageAllCapital = this.mortgageCapital + this.mortgagePublicCapital;                                      // 贷款本金                    this.monthAllRepay = this.monthRepay + this.monthPublicRepay;                                 // 第一个月还                    this.minusAllMouth = this.minusMouth + this.minusPublicMouth;                                    // 每月减少                    this.interestAllTotal = this.interestTotal + this.interestPublicTotal;                                   // 全部利息                    this.mortgageAllTotal = this.mortgageTotal + this.mortgagePublicTotal;      // 贷款总额                    // console.log(this)                }                break;        }    },    countFirstPayment : function () { // 计算首付数        if(this.loanType == 0 && this.countType == 0){            this.firstPayment = this.total - this.mortgageCapital;        }else if(this.loanType == 1 && this.countType == 0){            this.firstPayment = this.total - this.mortgagePublicCapital;        }    },    countMortgageTotal : function () { // 计算贷款总额        if (formState.loanMode == 1) return;        switch (this.loanType){            case 0 :                this.mortgageTotal = this.monthRepay * this.mortgageYears * 12;                break;            case 1 :                this.mortgagePublicTotal = this.monthPublicRepay * this.mortgageYears * 12;                break;            case 2 :                this.mortgageTotal = this.monthRepay * this.mortgageYears * 12;                this.mortgagePublicTotal = this.monthPublicRepay * this.mortgageYears * 12;                this.mortgageAllTotal = this.mortgageTotal + this.mortgagePublicTotal;                break;        }    },    countInterestTotal : function () { // 计算利息总数        switch (this.loanType){            case 0:                this.interestTotal = this.mortgageTotal - this.mortgageCapital;                break;            case 1:                this.interestPublicTotal = this.mortgagePublicTotal - this.mortgagePublicCapital;                break;            case 2:                this.interestTotal = this.mortgageTotal - this.mortgageCapital;                this.interestPublicTotal = this.mortgagePublicTotal - this.mortgagePublicCapital;                this.interestAllTotal = this.interestTotal + this.interestPublicTotal;                break;        }    },    countMortgageMonths : function () { // 计算还款月数        this.mortgageMonths = this.mortgageYears * 12;    },    getPaymentsPerMonth: function (loanAmount, rate) {        // 等额本息还款法计算公式：        // -- 月还款本息=〔贷款本金×月利率×（1＋月利率）＾还款月数〕÷〔（1＋月利率）＾还款月数－1〕        // -- 月利率=年利率÷12=0.0665÷12=0.005541667        // -- 其中＾符号表示乘方        // var loanAmount = this.mortgageCapital;        var months = this.mortgageMonths;        var rateOfMonth = rate / (12 * 100);        // 将计算所得的月还款金额(本息)返回        return loanAmount * rateOfMonth * Math.pow((1 + rateOfMonth), months) / (Math.pow((1 + rateOfMonth), months) - 1);    },    //等额本金计算    getPaymentsPerMonthCut : function (loanAmount,rate){        //每月应还款额        var mouthyPayment=0;        //总还款额        var yll=rate/(12*100);//年利率        var mouthyPay = loanAmount/this.mortgageMonths;//每月偿还本金        var mouthInterst=loanAmount*yll;//第一个月还利息        var firstMouthAll=mouthInterst+mouthyPay;//第一个月还款总额        var minusMouth=mouthyPay*yll;//每月还款减少        var secondMinus=firstMouthAll-minusMouth;//第二月还款额        //总利息=〔(总贷款额÷还款月数+总贷款额×月利率)+总贷款额÷还款月数×(1+月利率)〕÷2×还款月数-总贷款额        var interstAll=[(loanAmount/this.mortgageMonths+loanAmount*yll)+loanAmount/this.mortgageMonths*(1+yll)]/2*this.mortgageMonths-loanAmount;        var sumAll=loanAmount+interstAll;        this.minusMouth = minusMouth;        return {            'mouthyPay':mouthyPay,            'sum':loanAmount,            'interest':interstAll,            'firstMouthAll':firstMouthAll,            'minusMouth':minusMouth        };    },    /*-------------------------------------------------    * 渲染方法    * -----------------------------------------------*/    showRate : function () { // 渲染计算后的利率        document.getElementById('business-ratio').value = this.roteBusiness;        document.getElementById('public-ratio').value   = this.rotePublic;    },    showMsg : function () {        this.hideMsg();        $('#house-mortgage-month').show().find('span').html(this.mortgageMonths + '月');        if(this.loanType == 0){ // 商贷            if(this.countType == 0){ // 面积                $('#house-total').show().find('span').html(this.total.toFixed(2) + '元');                $('#house-first-payment').show().find('span').html(this.firstPayment.toFixed(2) + '元');                if(this.loanMode == 1){ // 本金                    $('#house-month-cut').show().find('span').html(this.minusMouth.toFixed(2) + '元');                }            }else if(this.countType == 1){ // 贷款数                if(this.loanMode == 1){ // 本金                    $('#house-month-cut').show().find('span').html(this.minusMouth.toFixed(2) + '元');                }            }            $('#house-mortgage-capital').show().find('span').html(this.mortgageCapital.toFixed(2) + '元');            $('#house-mortgage-total').show().find('span').html(this.mortgageTotal.toFixed(2) + '元');            $('#house-interest-total').show().find('span').html(this.interestTotal.toFixed(2) + '元');            $('#house-month-repay').show().find('span').html(this.monthRepay.toFixed(2) + '元');        }else if(this.loanType == 1){ // 公贷            if(this.countType == 0) { // 面积                $('#house-total').show().find('span').html(this.total.toFixed(2) + '元');                $('#house-first-payment').show().find('span').html(this.firstPayment.toFixed(2) + '元');                if(this.loanMode == 1){ // 本金                    $('#house-month-cut').show().find('span').html(this.minusPublicMouth.toFixed(2) + '元');                }            }else if(this.countType == 1) { // 贷款数                if(this.loanMode == 1){ // 本金                    $('#house-month-cut').show().find('span').html(this.minusPublicMouth.toFixed(2) + '元');                }            }            $('#house-mortgage-capital').show().find('span').html(this.mortgagePublicCapital.toFixed(2) + '元');            $('#house-mortgage-total').show().find('span').html(this.mortgagePublicTotal.toFixed(2) + '元');            $('#house-interest-total').show().find('span').html(this.interestPublicTotal.toFixed(2) + '元');            $('#house-month-repay').show().find('span').html(this.monthPublicRepay.toFixed(2) + '元');        }else if(this.loanType == 2){ // 组合            if(this.loanMode == 1){ // 本金                $('#house-month-cut').show().find('span').html(this.minusAllMouth.toFixed(2) + '元');            }            $('#house-mortgage-capital').show().find('span').html(this.mortgageAllCapital.toFixed(2) + '元');            $('#house-mortgage-total').show().find('span').html(this.mortgageAllTotal.toFixed(2) + '元');            $('#house-interest-total').show().find('span').html(this.interestAllTotal.toFixed(2) + '元');            $('#house-month-repay').show().find('span').html(this.monthAllRepay.toFixed(2) + '元');        }    },    hideMsg : function () {        $('.result-table li').hide().find('span').html("");        $('#result-total').hide().find('span').html("");    }};// 初始化formState.setLoanType(0);document.getElementById('business-ratio').value = RATE.business;document.getElementById('public-ratio').value = RATE.public;// 计算方式$('#count-type label').on('click',function () {    let _index = $(this).index();    formState.countType = _index;});// 按揭比例$('#mortgage-ratio select').on('change',function () {    let _val = $(this).val();    formState.mortgageRatio = parseFloat(_val);    formState.countRate()});// 贷款时间$('#mortgage-years select').on('change',function () {    let _val = $(this).val();    formState.mortgageYears = parseInt(_val);    formState.countRate();    formState.countMortgageMonths();});// 利率折扣$('#mortgage-rate select').on('change',function () {    let _val = $(this).val();    formState.mortgageSale = parseFloat(_val);    formState.countRate()});// 利率折扣$('#mortgage-public-rate select').on('change',function () {    let _val = $(this).val();    formState.mortgagePublicSale = parseFloat(_val);    formState.countRate()});// 计算房总价var _pass = false;$('#loan-commit').on('click',function () {    removeError();    if(formState.loanType === 0){ // 商业贷款        if(formState.countType === 0){ // 面积            acreageCount();        }else if(formState.countType === 1){ // 贷款总额            mortgageTotalCount();        }        if (!_pass)return;        showEchartData({            title1:'贷款总额',            title2:'支付利息',            data1:formState.mortgageCapital,            data2:formState.interestTotal        })    }else if(formState.loanType === 1){ // 公积金贷款        if(formState.countType === 0){ // 面积            acreageCount();        }else if(formState.countType === 1){ // 贷款总额            mortgageTotalCount();        }        if (!_pass)return;        showEchartData({title1:'贷款总额',title2:'支付利息',data1:formState.mortgagePublicCapital,data2:formState.interestPublicTotal})    }else if(formState.loanType === 2){ // 组合        allCount();        if (!_pass)return;        showEchartData({title1:'贷款总额',title2:'支付利息',data1:formState.mortgageAllCapital,data2:formState.interestAllTotal})    }    return false;});// 贷款计算器$('#loan-reset').on('click',function () {    $(this).parents('form').find('input[type="text"][readonly!="readonly"]').val("");// 清除文本框信息    removeError(); // 清除错误提示信息    $('#mortgage-ratio select').val('0.7').trigger('change');    $('#mortgage-years select').val('20').trigger('change');    $('#mortgage-rate select').val('1').trigger('change');    $('#loan-mode-1').trigger('click');formState.loanMode = 0;    if(formState.loanType == 0 || formState.loanType == 1){        $('#count-type-0').trigger('click');countType0Click(); // 重置计算方式    }});// 二手房税费$('#second-reset').on('click',function () {    $(this).parents('form')[0].reset();    taxState.taxationType = 0;    $('#second-house-old-price').hide();    removeError(); // 清除错误提示信息});function acreageCount() { // 编辑贷款运算    let _acreage = $('#acreage input'),// 面积        _acreageVal = parseFloat(_acreage.val()),        _acreageError = _acreage.attr('placeholder'),        _univalent = $('#univalent input'),   // 单价        _univalentVal = parseFloat(_univalent.val()),        _univalentError = _univalent.attr('placeholder');    if(!_univalentVal){        showError(_univalent,_univalentError);        return false;    }    if(!_acreageVal){        showError(_acreage,_acreageError);        return false;    }    _pass = true;    formState.acreage = _acreageVal;    formState.univalent = _univalentVal;    formState.countTotal();}function mortgageTotalCount() {    let _loanAll = $('#loan-all input'),        _loanAllVal = wanTrans(parseFloat(_loanAll.val())),        _loanAllError = _loanAll.attr('placeholder');    if(!_loanAllVal){        showError(_loanAll,_loanAllError);        return false;    }    _pass = true;    switch (formState.loanType){        case 0:            formState.mortgageCapital = _loanAllVal;            break;        case 1:            formState.mortgagePublicCapital = _loanAllVal;            break;    }    formState.countTotal();}// 组合计算function allCount() {    let _lBusiness = $('#loan-business input'),        _lBusinessVal = wanTrans(parseFloat(_lBusiness.val())),        _lBusinessError = _lBusiness.attr('placeholder'),        _lPublic = $('#loan-public input'),        _lPublicVal = wanTrans(parseFloat(_lPublic.val())),        _lPublicError = _lPublic.attr('placeholder');    if(!_lBusinessVal){        showError(_lBusiness,_lBusinessError);        return false;    }    if(!_lPublicVal){        showError(_lPublic,_lPublicError);        return false;    }    _pass = true;    formState.mortgageCapital = _lBusinessVal;    formState.mortgagePublicCapital = _lPublicVal;    formState.countMortgageCapital();   // 计算贷款本金    formState.countMortgageTotal();     // 计算贷款总数    formState.countInterestTotal();     // 计算利息    formState.showMsg();                // 渲染HTML}function showError(obj,errorText) {    $(obj).parent().append('<div class="calculator-form-error">'+ errorText +'</div>')}function removeError() {    $('.calculator-form-error').remove()}$('#loan-type-0').on('click',function () {    formState.setLoanType(0);    switch (formState.countType){        case 0 :            showCountType();    // 显示计算方法            showAcreageForm();  // 显示面积计算            showMortgageRatio();// 显示按揭比例            showRatioBusiness();    // 显示商贷利率            hideRatioPublic();    // 隐藏公贷利率            hideTotal();        // 隐藏总价计算            hideLoanAll();      // 隐藏组合计算            break;        case 1:            showCountType();    // 显示计算方法            hideAcreageForm();  // 隐藏面积计算            hideMortgageRatio();// 隐藏按揭比例            showTotal();        // 显示总价计算            showRatioBusiness();    // 显示商贷利率            hideRatioPublic();    // 隐藏公贷利率            hideLoanAll();      // 隐藏组合计算            break;    }    _pass = false;});$('#loan-type-1').on('click',function () {    formState.setLoanType(1);    switch (formState.countType){        case 0 :            showCountType();        // 显示计算方法            showAcreageForm();      // 显示面积计算            showMortgageRatio();    // 显示按揭比例            hideRatioBusiness();    // 隐藏商贷利率            showRatioPublic();      // 显示公贷利率            hideTotal();            // 隐藏总价计算            hideLoanAll();          // 隐藏组合计算            break;        case 1:            showCountType();        // 显示计算方法            hideAcreageForm();      // 隐藏面积计算            hideMortgageRatio();    // 隐藏按揭比例            hideRatioBusiness();    // 隐藏商贷利率            showRatioPublic();      // 显示公贷利率            showTotal();            // 隐藏总价计算            hideLoanAll();          // 隐藏组合计算            break;    }    _pass = false;});$('#loan-type-2').on('click',function () {    formState.setLoanType(2);    hideCountType();        // 隐藏计算方法    hideAcreageForm();      // 隐藏面积计算    hideTotal();            // 隐藏面积计算    hideMortgageRatio();    // 隐藏按揭比例    showLoanAll();          // 显示组合计算    showRatioBusiness();    showRatioPublic();    _pass = false;});$('#count-type-0').on('click',countType0Click);function countType0Click() {    formState.countType = 0;    showAcreageForm();      // 显示计算方法    showMortgageRatio();    // 显示按揭比例    hideTotal();            // 隐藏面积计算}$('#count-type-1').on('click',function () {    formState.countType = 1;    hideAcreageForm();      // 隐藏计算方法    hideMortgageRatio();    // 隐藏按揭比例    showTotal();            // 显示面积计算});// 贷款方式$('#loan-mode-1').on('click',function () {    formState.loanMode = 0;});$('#loan-mode-2').on('click',function () {    formState.loanMode = 1;});// 显示组合贷款function showLoanAll() {  document.getElementById('loan-business').style.display = 'block';  document.getElementById('loan-public').style.display = 'block';}// 隐藏组合贷款function hideLoanAll() {  document.getElementById('loan-business').style.display = 'none';  document.getElementById('loan-public').style.display = 'none';}// 显示计算方式function showCountType() {    document.getElementById('count-type').style.display = 'block';}function hideCountType() {    document.getElementById('count-type').style.display = 'none';}// 显示商贷利率function showRatioBusiness() {    document.getElementById('mortgage-rate').style.display = 'block';}function hideRatioBusiness() {    document.getElementById('mortgage-rate').style.display = 'none';}// 显示公贷利率function showRatioPublic() {    document.getElementById('mortgage-public-rate').style.display = 'block';}function hideRatioPublic() {    document.getElementById('mortgage-public-rate').style.display = 'none';}// 显示贷款总价计算function showTotal() {    document.getElementById('loan-all').style.display = 'block';}function hideTotal() {    document.getElementById('loan-all').style.display = 'none';}// 显示隐藏按揭比例function showMortgageRatio() {    document.getElementById('mortgage-ratio').style.display = 'block';}function hideMortgageRatio() {    document.getElementById('mortgage-ratio').style.display = 'none';}// 显示面积计算表单function showAcreageForm() {    document.getElementById('univalent').style.display = 'block';    document.getElementById('acreage').style.display = 'block';}// 隐藏面积计算表单function hideAcreageForm() {    document.getElementById('univalent').style.display = 'none';    document.getElementById('acreage').style.display = 'none';}// 显示图标数据function showEchartData(options) {    let optionsLength = Object.keys(options).length / 2,        legendData = [],        seriesData = [];    for(let i = 1; i <= optionsLength; i++){        legendData.push(options['title' + i]);        seriesData.push({name:options['title' + i],value:options['data' + i].toFixed(2)});    }    myChart.setOption({        tooltip : {            show : true,            trigger: 'item',            formatter: "{a} <br/>{b} : {c} ({d}%)"        },        legend: {            show : true,            data:legendData,            orient : 'vertical',            left : 'right',            selectedMode : false        },        series: [{            data: seriesData        }]    });}// 重置图标function resetChart() {    myChart.setOption({        tooltip : {            show : false        },        legend: {            show : false        },        series: [{            // name : none,            type: 'pie',            data: [                {value:0, name:'无计算信息'},            ]        }]    });}// 图表var myChart = echarts.init(document.getElementById('e-chart'));var option = {    series: [{        name : '计算结果',        type: 'pie',        data: [            {value:0, name:'无计算信息'},        ]    }],    color : ['#81b6f2','#ffba00','#8dd569']};// 使用刚指定的配置项和数据显示图表。myChart.setOption(option);//-------------------------------二手房税费计算var taxState = {    acreage : null,     // 面积    total : null,       // 总价    taxationType : 0,   // 计征方式[0:总价 1:差价]    oldPrice : null,    // 原价    houseType : 0,      // 住宅类型[0:普通 1:非普通]    years : 0,          // 住宅年限[0:2年内 1:2-5年 2:5年以上]    first: 0,           // 首套[0:首套 1:非首套]    only : 0,           // 唯一住房[0:唯一 1:非唯一]    differ: 1           // 差价};// 征讨方式$('#second-house-taxation-type label').on('click',function () {    let _index = $(this).index();    switch (_index){        case 0:            $('#second-house-old-price').hide();            taxState.taxationType = 0;            break;        case 1:            $('#second-house-old-price').show();            taxState.taxationType = 1;            break;    }});// 住宅类型$('#second-house-type label').on('click',function () {    let _index = $(this).index();    taxState.houseType = _index;});// 住宅年限$('#second-house-years label').on('click',function () {    let _index = $(this).index();    taxState.years = _index;});// 首套$('#second-house-first label').on('click',function () {    let _index = $(this).index();    taxState.first = _index;});// 唯一$('#second-house-only label').on('click',function () {    let _index = $(this).index();    taxState.only = _index;});//计算公式function getRateResult(years,firstBuy,only,area,sum){    /*    * years    : 房产年限    * firstBuy : 首次购买    * only     : 唯一    * area     : 面积    * sum      : 总价    * */    //sum 总价减去原价 原价没有填写默认0    var result = {        landIncrementTax: 0,//土地增值税        deedTax: 0,//契税        personalTax: 0,//个人所得税        sum: sum//总价    };    //契税    if(taxState.differ <= 0){ // 差价小于等于 0        if (firstBuy == 0) {            if (area <= 90) {                result.deedTax = sum / 100;            } else {                result.deedTax = sum * 1.5 / 100;            }        } else {            result.deedTax = sum * 3 / 100;        }    }else{        // 契税        if (firstBuy == 0) { // 首次购买            if (area <= 90) {                result.deedTax = sum * 0.01;            } else {                result.deedTax = sum * 0.015;            }        } else {            result.deedTax = sum * 0.03;        }        // 土地增值税        /*if (years == 0) {            result.landIncrementTax = taxState.differ / 1.05 * 0.05;        } else {            if (area <= 140) {                result.landIncrementTax = 0;            }else{                result.landIncrementTax = taxState.differ / 1.05 * 0.05;            }        }*/        if (area <= 140) {            if (years == 0) {              result.landIncrementTax = sum / 1.05 * 0.05;            }else {              result.landIncrementTax = 0;            }        } else {          if (years == 0) {            result.landIncrementTax = sum / 1.05 * 0.05;          }else{            result.landIncrementTax = taxState.differ / 1.05 * 0.05;          }        }        //个人所得税        if (only == 0 && years == 2) {            result.personalTax = 0;        } else {            result.personalTax = taxState.differ * 0.2;        }    }    return result;}$('#tax-commit').on('click',function () {    removeError();    let _acreage = $('#second-house-acreage input'),// 面积        _acreageVal = parseFloat(_acreage.val()),        _acreageError = _acreage.attr('placeholder'),        _total = $('#second-house-total input'),   // 总价        _totalVal = wanTrans(parseFloat(_total.val())),        _totalError = _total.attr('placeholder'),        _oldPrice = $('#second-house-old-price input'),   // 原价        _oldPriceVal = wanTrans(parseFloat(_oldPrice.val())),        _oldPriceError = _oldPrice.attr('placeholder'),        _chajia,        _result;    if(!_acreageVal){        showError(_acreage,_acreageError);        return false;    }    if(!_totalVal){        showError(_total,_totalError);        return false;    }    if(taxState.taxationType == 1){ // 计征方式为差价        if(!_oldPriceVal){            showError(_oldPrice,_oldPriceError);            return false;        }        _chajia = _totalVal - _oldPriceVal;    }else{        _chajia = _totalVal;    }    taxState.acreage = _acreageVal;    taxState.total = _totalVal;    taxState.houseType = $('input:radio[name="house-type"]:checked').parent().index();    taxState.years = $('input:radio[name="house-years"]:checked').parent().index();    taxState.first = $('input:radio[name="house-first"]:checked').parent().index();    taxState.only = $('input:radio[name="house-only"]:checked').parent().index();    taxState.differ = _chajia;    _result = getRateResult(taxState.years,taxState.first,taxState.only,taxState.acreage,taxState.total);    showTaxMsg(_result);    if(_result.personalTax == 0 && _result.landIncrementTax == 0){        showEchartData({            title1:'契税',            data1:_result.deedTax,        });    }else if(_result.landIncrementTax == 0){        showEchartData({            title1:'契税',            title2:'个人所得税',            data1:_result.deedTax,            data2:_result.personalTax        });    }else if(_result.personalTax == 0){        showEchartData({            title1:'契税',            title2:'增值税',            data1:_result.deedTax,            data2:_result.landIncrementTax        });    }else{        showEchartData({            title1:'契税',            title2:'个人所得税',            title3:'增值税',            data1:_result.deedTax,            data2:_result.personalTax,            data3:_result.landIncrementTax        });    }});function showTaxMsg(msg) {    let _total = msg.deedTax + msg.personalTax + msg.landIncrementTax;    formState.hideMsg();    $('#house-deed-tax').show().find('span').html(msg.deedTax.toFixed(2) + '元');    $('#house-income-tax').show().find('span').html(msg.personalTax.toFixed(2) + '元');    $('#house-added-tax').show().find('span').html(msg.landIncrementTax.toFixed(2) + '元');    $('#result-total').show().find('span').html(_total.toFixed(2) + '元');}// 转换万元function wanTrans(num) {    return num * 10000;}// 表单限制输入$('input[type="text"]').on('keyup',function () {    $(this).val($(this).val().replace(/[^\d\.]/g,''))});// 显示贷款信息模板function showLoanTemp() {    $('#house-total').show();    $('#house-mortgage-capital').show();    $('#house-mortgage-total').show();    $('#house-interest-total').show();    $('#house-first-payment').show();    $('#house-mortgage-month').show();    $('#house-month-repay').show();    $('#result-title1').show();    $('#result-title2').hide();}// 显示税费模板function showSecTemp() {    $('#house-deed-tax').show();    $('#house-income-tax').show();    $('#house-added-tax').show();    $('#result-total').show();    $('#result-title1').hide();    $('#result-title2').show();}